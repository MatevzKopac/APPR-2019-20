---
title: "Analiza zdravstvenih podjetji s programom R"
author: "Matevž Kopač"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
runtime: shiny
---

```{r setup, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
#source("fontconfig.r", encoding="UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding="UTF-8")
```

```{r rstudio, echo=FALSE, results='asis'}
# Izris povezave do RStudia na Binderju
source("lib/rstudio.r", encoding="UTF-8")
```

# Izbira teme

Za projekt sem si izbral analizo zdravstvenih podjetji v Sloveniji. Analizo bom pripravil na podlagi podatkov iz Ajpesa in Erar-a. Osredotočil se bom na prihodke, izkaz poslovnega izida in bilanco stanja za leta 2015-2018.  S spletne strani Erar pa bom pridobil podatke za prejemke iz javnih sredstev za leti 2017 in 2018. Podatke bom s spletnih strani izločil s pomočjo scraperja in jih uvozil v excel(iskal bom po davčni številki podjetja), iz Vzajemnine baze podatkov pa sem priodbil podatke o obsegu podjetja, vrsti zdravstvene dejavnosti in številu zaposlenih. 

Pregled podatkov bo temeljil na lokaciji zdravstvenega izvajalca, vrsti izvajane zdravstvene dejavnosti, število zaposlenih, dobičku, prihodkih, razmerju med dobičkom in prejemkih iz javnih sredstev ter deleža prejemkov iz javnih sredstev v prihodkih.

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz, echo=FALSE, message=FALSE}
source("uvoz/uvoz.r", encoding="UTF-8")
```

Uvozil sem podatke o slovenskih zdravstvenih podjetjih v obliki CSV, katero sem pridobil iz excelovega dokmenta. V njem je veliko podatkov, katerih v analizi nisem uporabil, iz Ajpesa in portala Erar pa sem pridobil še nekaj številskih podatkov s pomočjo scraperja napisanega v pythonu. Tabelo sem po uvozu očistil vseh za analizo ne potrebnih podatkov in jih ločil n dve razpredelnici v obliki "tidy data". Poleg dveh večjih rapredelnic sem naredil še dve manjši, ki služita zgolj kot legenda k podatkom.


1. "osnovni_podatki"
`opisni podatki za zdravstvena podajetja
  - `NAZIV` - ime zdravstvenega podjetja,
  - `regija` - k regiji pripisano število, katero lahko odčitamo iz 'legenda_regij',
  - `DEJAVNOAST` - meritev: število družin z ustreznim številom otrok v ustrezni občini (število)
  - 'DEJAVNOST ŠTEVILKA' - vrsta zdravstvene storitve, katero ponuja podjetje
  - 'VELIKOST SUBJEKTA' - velikost podajetja glede na število zaposlenih 
  - 'ŠTEVILO ZAPOSLENIH' - število zaposlenih v zdravstvenem podjetju
  

2. "stevilski_podatki" - podatki o poslovanju zdravstvenih podjetji v €
  - `NAZIV` - ime zdravstvenega podjetja,
  - `Prihodki 2018` - letni prihodek v letu 2018,
  - `Prihodki 2017` - letni prihodek v letu 2017,
  - `Prihodki 2016` - letni prihodek v letu 2016,
  - `Prihodki 2015` - letni prihodek v letu 2015,
  - `Dobiček 2018` - letni dobiček v letu 2018,
  - `Dobiček 2017` - letni dobiček v letu 2017,
  - `Dobiček 2016` - letni dobiček v letu 2016,
  - `Dobiček 2015` - letni dobiček v letu 2015,,
  - `Osnovna sredstva 2018` - sredstva prejeta v letu 2018,
  - `Osnovna sredstva 2017` - sredstva prejeta v letu 2017,
  - `Osnovna sredstva 2016` - sredstva prejeta v letu 2016,
  - `Osnovna sredstva 2015` - sredstva prejeta v letu 2015,
  - 'Prejemki iz javnih sredstev 2018' - količina prejetih sredstev iz javnih skladov v 2018,
  - 'Prejemki iz javnih sredstev 2017' - količina prejetih sredstev iz javnih skladov v 2017,





# Analiza in vizualizacija podatkov

```{r vizualizacija, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
source("vizualizacija/vizualizacija.r", encoding="UTF-8")
```

Spodnji zemljevid prikazuje povprečno velikost družine za vsako občino.

```{r zemljevid, echo=FALSE, fig.align='center', fig.cap='Zemljevid povprečnega števila otrok v družini'}
ggplot() + geom_polygon(data=left_join(zemljevid, povprecja, by=c("OB_UIME"="obcina")),
                        aes(x=long, y=lat, group=group, fill=povprecje)) +
  ggtitle("Povprečno število otrok v družini") + xlab("") + ylab("") +
  guides(fill=guide_colorbar(title="Povprečje"))
```

***

# Napredna analiza podatkov

```{r analiza, echo=FALSE, message=FALSE}
source("analiza/analiza.r", encoding="UTF-8")
```

Spodnji graf prikazuje povezavo med številom naselij in površino občine.

```{r graf, echo=FALSE, fig.align='center', fig.cap='Povezava med številom naselij in površino občine'}
ggplot(inner_join(obcine, data.frame(obcina=names(skupine),
                                     skupina=factor(skupine)), by="obcina")
, aes(x=povrsina, y=naselja, color=skupina, size=prebivalci/1000)) + geom_point() +
  ggtitle("Število naselij glede na površino občine") +
  xlab(expression("Površina (km"^2 * ")")) + ylab("Št. naselij") +
  guides(color=guide_legend(title="Skupina"),
         size=guide_legend(title="Prebivalci (* 1000)"))
```

***

```{r shiny, echo=FALSE}
shinyAppDir("shiny", options=list(width="100%", height=600))
```
